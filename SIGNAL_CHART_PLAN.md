# ä¿¡å·å¯è§†åŒ–æŠ˜çº¿å›¾ - å®ç°è®¡åˆ’

## ğŸ“‹ éœ€æ±‚åˆ†æ

å°† DBC æ–‡ä»¶ä¸­çš„ä¿¡å·è§£æå¹¶ç»˜åˆ¶æˆå¯è§†åŒ–çš„æŠ˜çº¿å›¾ã€‚

## ğŸ¯ åŠŸèƒ½è®¾è®¡

### æ ¸å¿ƒåŠŸèƒ½

1. **ä¿¡å·é€‰æ‹©**
   - ä»å·²åŠ è½½çš„ DBC æ–‡ä»¶ä¸­é€‰æ‹©ä¿¡å·
   - æ”¯æŒå¤šä¿¡å·åŒæ—¶æ˜¾ç¤º
   - ä¿¡å·åˆ—è¡¨å±•ç¤º

2. **æ•°æ®è§£æ**
   - ä» BLF æ–‡ä»¶ä¸­æå– CAN æ¶ˆæ¯
   - æ ¹æ® DBC å®šä¹‰è§£æä¿¡å·å€¼
   - è®¡ç®—ç‰©ç†å€¼ï¼ˆåº”ç”¨ factor å’Œ offsetï¼‰

3. **å›¾è¡¨ç»˜åˆ¶**
   - æ—¶é—´è½´ï¼ˆX è½´ï¼‰
   - ä¿¡å·å€¼ï¼ˆY è½´ï¼‰
   - å¤šæ¡æŠ˜çº¿ï¼ˆä¸åŒä¿¡å·ï¼‰
   - å›¾ä¾‹
   - ç¼©æ”¾å’Œå¹³ç§»

4. **äº¤äº’åŠŸèƒ½**
   - é¼ æ ‡æ‚¬åœæ˜¾ç¤ºå€¼
   - ç¼©æ”¾ï¼ˆæ»šè½®ï¼‰
   - å¹³ç§»ï¼ˆæ‹–æ‹½ï¼‰
   - æ—¶é—´èŒƒå›´é€‰æ‹©

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### æ•°æ®æµ

```
BLF æ–‡ä»¶ â†’ CAN æ¶ˆæ¯
    â†“
DBC æ–‡ä»¶ â†’ ä¿¡å·å®šä¹‰
    â†“
ä¿¡å·è§£æå™¨ â†’ æ—¶é—´åºåˆ—æ•°æ®
    â†“
å›¾è¡¨æ¸²æŸ“å™¨ â†’ æŠ˜çº¿å›¾
```

### ç»„ä»¶åˆ’åˆ†

1. **SignalParser** - ä¿¡å·è§£æ
2. **TimeSeriesData** - æ—¶é—´åºåˆ—æ•°æ®ç»“æ„
3. **ChartRenderer** - å›¾è¡¨æ¸²æŸ“
4. **SignalSelector** - ä¿¡å·é€‰æ‹©å™¨ UI

## ğŸ“Š æ•°æ®ç»“æ„

### SignalData

```rust
pub struct SignalData {
    pub name: String,
    pub message_id: u32,
    pub start_bit: u16,
    pub bit_length: u16,
    pub factor: f64,
    pub offset: f64,
    pub unit: String,
}
```

### TimeSeriesPoint

```rust
pub struct TimeSeriesPoint {
    pub timestamp: f64,  // ç§’
    pub value: f64,      // ç‰©ç†å€¼
}
```

### SignalTimeSeries

```rust
pub struct SignalTimeSeries {
    pub signal_name: String,
    pub points: Vec<TimeSeriesPoint>,
    pub color: Rgb,
}
```

## ğŸ¨ UI è®¾è®¡

### å¸ƒå±€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [Chart] è§†å›¾                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å·¦ä¾§ï¼šä¿¡å·åˆ—è¡¨                â”‚ å³ä¾§ï¼šå›¾è¡¨åŒºåŸŸ              â”‚
â”‚                              â”‚                           â”‚
â”‚ â–¡ Speed (km/h)               â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â˜‘ RPM (rpm)                  â”‚    â”‚                 â”‚   â”‚
â”‚ â˜‘ Temperature (Â°C)           â”‚    â”‚   æŠ˜çº¿å›¾        â”‚   â”‚
â”‚ â–¡ Voltage (V)                â”‚    â”‚                 â”‚   â”‚
â”‚                              â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚ [+ Add Signal]               â”‚                           â”‚
â”‚                              â”‚    æ—¶é—´è½´ â†’              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å›¾è¡¨å…ƒç´ 

1. **åæ ‡è½´**
   - X è½´ï¼šæ—¶é—´ï¼ˆç§’ï¼‰
   - Y è½´ï¼šä¿¡å·å€¼ï¼ˆè‡ªåŠ¨ç¼©æ”¾ï¼‰

2. **æŠ˜çº¿**
   - ä¸åŒé¢œè‰²åŒºåˆ†ä¿¡å·
   - çº¿å®½ï¼š2px
   - å¹³æ»‘æ›²çº¿

3. **å›¾ä¾‹**
   - ä¿¡å·åç§°
   - å•ä½
   - å½“å‰å€¼

4. **ç½‘æ ¼çº¿**
   - æµ…è‰²èƒŒæ™¯ç½‘æ ¼
   - ä¸»è¦åˆ»åº¦å’Œæ¬¡è¦åˆ»åº¦

## ğŸ”§ å®ç°æ­¥éª¤

### é˜¶æ®µ 1: æ•°æ®è§£æï¼ˆæ ¸å¿ƒï¼‰

1. **åˆ›å»ºä¿¡å·è§£æå™¨**
   ```rust
   // src/view/src/signal_parser.rs
   pub struct SignalParser {
       dbc_database: DbcDatabase,
   }
   
   impl SignalParser {
       pub fn parse_message(&self, msg_id: u32, data: &[u8]) -> HashMap<String, f64> {
           // è§£ææ¶ˆæ¯ä¸­çš„æ‰€æœ‰ä¿¡å·
       }
       
       pub fn extract_signal(&self, msg_id: u32, signal_name: &str, data: &[u8]) -> Option<f64> {
           // æå–å•ä¸ªä¿¡å·å€¼
       }
   }
   ```

2. **æ„å»ºæ—¶é—´åºåˆ—æ•°æ®**
   ```rust
   pub fn build_time_series(
       &self,
       messages: &[LogObject],
       signal_name: &str
   ) -> SignalTimeSeries {
       // ä» BLF æ¶ˆæ¯ä¸­æå–ä¿¡å·æ—¶é—´åºåˆ—
   }
   ```

### é˜¶æ®µ 2: å›¾è¡¨æ¸²æŸ“ï¼ˆUIï¼‰

1. **ä½¿ç”¨ plotters åº“**
   ```rust
   use plotters::prelude::*;
   use plotters::backend::RGBPixel;
   ```

2. **åˆ›å»ºå›¾è¡¨ç»„ä»¶**
   ```rust
   // src/view/src/ui/components/signal_chart.rs
   pub fn render_signal_chart(
       time_series: &[SignalTimeSeries],
       width: u32,
       height: u32
   ) -> Vec<u8> {
       // è¿”å› PNG å›¾åƒæ•°æ®
   }
   ```

3. **é›†æˆåˆ° GPUI**
   ```rust
   // åœ¨ render() ä¸­æ˜¾ç¤ºå›¾è¡¨
   .child(
       img(chart_image_data)
           .w(px(800.))
           .h(px(400.))
   )
   ```

### é˜¶æ®µ 3: ä¿¡å·é€‰æ‹©å™¨ï¼ˆUIï¼‰

1. **ä¿¡å·åˆ—è¡¨**
   ```rust
   pub fn render_signal_list(
       signals: &[SignalData],
       selected: &HashSet<String>,
       cx: &mut Context<CanViewApp>
   ) -> impl IntoElement {
       // æ¸²æŸ“å¯é€‰æ‹©çš„ä¿¡å·åˆ—è¡¨
   }
   ```

2. **å¤é€‰æ¡†äº¤äº’**
   ```rust
   .on_mouse_down(gpui::MouseButton::Left, cx.listener(move |this, _, _, cx| {
       this.toggle_signal_selection(&signal_name);
       cx.notify();
   }))
   ```

### é˜¶æ®µ 4: äº¤äº’åŠŸèƒ½

1. **ç¼©æ”¾**
   ```rust
   .on_scroll_wheel(cx.listener(|this, event, _, cx| {
       this.chart_zoom_level *= 1.0 + event.delta.y * 0.1;
       cx.notify();
   }))
   ```

2. **å¹³ç§»**
   ```rust
   .on_drag(cx.listener(|this, event, _, cx| {
       this.chart_offset += event.delta;
       cx.notify();
   }))
   ```

## ğŸ“¦ ä¾èµ–åº“

### å·²æœ‰

- âœ… `plotters` - å›¾è¡¨ç»˜åˆ¶
- âœ… `parser::dbc` - DBC è§£æ
- âœ… `blf` - BLF æ–‡ä»¶è¯»å–

### å¯èƒ½éœ€è¦

- `image` - å›¾åƒå¤„ç†ï¼ˆå¦‚æœéœ€è¦ï¼‰
- `base64` - å›¾åƒç¼–ç ï¼ˆå·²æœ‰ï¼‰

## ğŸ¯ æœ€å°å¯è¡Œäº§å“ï¼ˆMVPï¼‰

### ç¬¬ä¸€ç‰ˆåŠŸèƒ½

1. âœ… åŠ è½½ BLF æ–‡ä»¶
2. âœ… åŠ è½½ DBC æ–‡ä»¶
3. âœ… é€‰æ‹©ä¸€ä¸ªä¿¡å·
4. âœ… ç»˜åˆ¶æŠ˜çº¿å›¾
5. âœ… æ˜¾ç¤ºæ—¶é—´è½´å’Œå€¼è½´

### åç»­å¢å¼º

- [ ] å¤šä¿¡å·åŒæ—¶æ˜¾ç¤º
- [ ] ç¼©æ”¾å’Œå¹³ç§»
- [ ] é¼ æ ‡æ‚¬åœæ˜¾ç¤ºå€¼
- [ ] å¯¼å‡ºå›¾è¡¨ä¸ºå›¾ç‰‡
- [ ] æ—¶é—´èŒƒå›´é€‰æ‹©
- [ ] ä¿¡å·ç»Ÿè®¡ï¼ˆæœ€å¤§å€¼ã€æœ€å°å€¼ã€å¹³å‡å€¼ï¼‰

## ğŸ“ å®ç°ä¼˜å…ˆçº§

### P0 - æ ¸å¿ƒåŠŸèƒ½

1. ä¿¡å·è§£æå™¨
2. æ—¶é—´åºåˆ—æ•°æ®æ„å»º
3. åŸºæœ¬å›¾è¡¨æ¸²æŸ“
4. Chart è§†å›¾é›†æˆ

### P1 - åŸºç¡€äº¤äº’

1. ä¿¡å·é€‰æ‹©å™¨
2. å•ä¿¡å·æ˜¾ç¤º
3. å›¾ä¾‹æ˜¾ç¤º

### P2 - å¢å¼ºåŠŸèƒ½

1. å¤šä¿¡å·æ˜¾ç¤º
2. ç¼©æ”¾å¹³ç§»
3. é¼ æ ‡äº¤äº’

## ğŸ” æŠ€æœ¯éš¾ç‚¹

### 1. ä¿¡å·è§£æ

**æŒ‘æˆ˜**: ä»åŸå§‹å­—èŠ‚ä¸­æå–ä¿¡å·å€¼

**è§£å†³**: 
- ä½¿ç”¨ä½æ“ä½œæå–
- åº”ç”¨ factor å’Œ offset
- å¤„ç†å¤§å°ç«¯

### 2. å›¾è¡¨æ€§èƒ½

**æŒ‘æˆ˜**: å¤§é‡æ•°æ®ç‚¹çš„æ¸²æŸ“æ€§èƒ½

**è§£å†³**:
- æ•°æ®æŠ½æ ·ï¼ˆé™é‡‡æ ·ï¼‰
- åªæ¸²æŸ“å¯è§èŒƒå›´
- ä½¿ç”¨ç¼“å­˜

### 3. GPUI é›†æˆ

**æŒ‘æˆ˜**: plotters ç”Ÿæˆçš„å›¾åƒå¦‚ä½•åœ¨ GPUI ä¸­æ˜¾ç¤º

**è§£å†³**:
- ä½¿ç”¨ base64 ç¼–ç 
- æˆ–ä½¿ç”¨ GPUI çš„ç»˜å›¾ API

## ğŸ“š å‚è€ƒèµ„æ–™

- DBC æ ¼å¼è§„èŒƒ
- plotters æ–‡æ¡£
- GPUI ç»˜å›¾ API

## âœ… éªŒæ”¶æ ‡å‡†

1. [ ] èƒ½åŠ è½½ BLF å’Œ DBC æ–‡ä»¶
2. [ ] èƒ½é€‰æ‹©ä¿¡å·
3. [ ] èƒ½æ˜¾ç¤ºæŠ˜çº¿å›¾
4. [ ] å›¾è¡¨æœ‰æ—¶é—´è½´å’Œå€¼è½´
5. [ ] å›¾è¡¨æœ‰å›¾ä¾‹
6. [ ] æ€§èƒ½å¯æ¥å—ï¼ˆ< 1ç§’æ¸²æŸ“ï¼‰

---

**åˆ›å»ºæ—¥æœŸ**: 2026-01-25  
**çŠ¶æ€**: ğŸ“‹ è®¡åˆ’ä¸­  
**ä¼˜å…ˆçº§**: P0
