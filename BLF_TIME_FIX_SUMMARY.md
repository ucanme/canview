# BLF æ—¶é—´è§£æä¿®å¤æ€»ç»“

## âœ… é—®é¢˜å·²è§£å†³

**é—®é¢˜**: BLF æ–‡ä»¶ä¸­æ‰€æœ‰ message çš„æ—¶é—´éƒ½æ˜¾ç¤ºç›¸åŒ

**åŸå› **: åªä½¿ç”¨äº†ç›¸å¯¹æ—¶é—´æˆ³ï¼ˆåç§»é‡ï¼‰ï¼Œæ²¡æœ‰åŠ ä¸ŠåŸºå‡†æ—¶é—´

**è§£å†³**: å®ç°äº†å®Œæ•´çš„æ—¶é—´è½¬æ¢åŠŸèƒ½ï¼Œæ”¯æŒ"åŸºå‡†æ—¶é—´ + åç§»æ—¶é—´"çš„è®¡ç®—

## ğŸ“¦ å®ç°çš„åŠŸèƒ½

### 1. SystemTime æ—¶é—´è½¬æ¢æ–¹æ³•

**æ–‡ä»¶**: `src/blf/src/file_statistics.rs`

```rust
impl SystemTime {
    // è½¬æ¢ä¸º Unix æ—¶é—´æˆ³ï¼ˆçº³ç§’ï¼‰
    pub fn to_timestamp_nanos(&self) -> i64
    
    // æ·»åŠ çº³ç§’åç§»
    pub fn add_nanoseconds(&self, offset_ns: u64) -> i64
    
    // æ ¼å¼åŒ–åŸºå‡†æ—¶é—´
    pub fn format(&self) -> String
    
    // æ ¼å¼åŒ–ç»å¯¹æ—¶é—´ï¼ˆåŸºå‡† + åç§»ï¼‰
    pub fn format_with_offset(&self, offset_ns: u64) -> String
}
```

### 2. BlfResult ä¾¿æ·æ–¹æ³•

**æ–‡ä»¶**: `src/blf/src/file.rs`

```rust
impl BlfResult {
    // è½¬æ¢ä¸ºç»å¯¹æ—¶é—´æˆ³
    pub fn to_absolute_timestamp_ns(&self, relative_ns: u64) -> i64
    
    // æ ¼å¼åŒ–æ—¶é—´æˆ³
    pub fn format_timestamp(&self, relative_ns: u64) -> String
    
    // è·å–æµ‹é‡å¼€å§‹æ—¶é—´
    pub fn measurement_start_time_str(&self) -> String
}
```

### 3. æ·»åŠ  chrono ä¾èµ–

**æ–‡ä»¶**: `src/blf/Cargo.toml`

```toml
[dependencies]
chrono = "0.4"
```

## ğŸ¯ ä½¿ç”¨ç¤ºä¾‹

### åŸºç¡€ç”¨æ³•

```rust
use blf::read_blf_from_file;

let blf_result = read_blf_from_file("test.blf")?;

// æ˜¾ç¤ºåŸºå‡†æ—¶é—´
println!("å¼€å§‹æ—¶é—´: {}", blf_result.measurement_start_time_str());

// æ˜¾ç¤ºæ¯æ¡æ¶ˆæ¯çš„å®é™…æ—¶é—´
for obj in &blf_result.objects {
    let time_str = blf_result.format_timestamp(obj.timestamp());
    println!("æ¶ˆæ¯æ—¶é—´: {}", time_str);
}
```

### è¾“å‡ºç¤ºä¾‹

```
å¼€å§‹æ—¶é—´: 2026-01-25 16:30:00.000
æ¶ˆæ¯æ—¶é—´: 2026-01-25 16:30:00.001234
æ¶ˆæ¯æ—¶é—´: 2026-01-25 16:30:00.002456
æ¶ˆæ¯æ—¶é—´: 2026-01-25 16:30:00.003789
...
```

## ğŸ“Š æ—¶é—´è®¡ç®—åŸç†

```
BLF æ–‡ä»¶ç»“æ„:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FileStatistics                      â”‚
â”‚  - measurement_start_time           â”‚ â† åŸºå‡†æ—¶é—´
â”‚    (2026-01-25 16:30:00.000)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ LogObject 1                         â”‚
â”‚  - object_time_stamp: 1,234,000 ns â”‚ â† åç§»æ—¶é—´
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ LogObject 2                         â”‚
â”‚  - object_time_stamp: 2,456,000 ns â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å®é™…æ—¶é—´è®¡ç®—:
Message 1 = åŸºå‡†æ—¶é—´ + 1,234,000 ns
          = 2026-01-25 16:30:00.001234

Message 2 = åŸºå‡†æ—¶é—´ + 2,456,000 ns
          = 2026-01-25 16:30:00.002456
```

## ğŸ”§ æŠ€æœ¯ç»†èŠ‚

### æ—¶é—´å•ä½

- **åŸºå‡†æ—¶é—´**: `SystemTime` ç»“æ„ï¼ˆå¹´ã€æœˆã€æ—¥ã€æ—¶ã€åˆ†ã€ç§’ã€æ¯«ç§’ï¼‰
- **åç§»æ—¶é—´**: `u64` çº³ç§’ï¼ˆnsï¼‰
- **ç»å¯¹æ—¶é—´**: `i64` çº³ç§’ï¼ˆUnix timestampï¼‰

### ç²¾åº¦

- **è¾“å…¥ç²¾åº¦**: æ¯«ç§’ï¼ˆåŸºå‡†æ—¶é—´ï¼‰+ çº³ç§’ï¼ˆåç§»ï¼‰
- **è¾“å‡ºç²¾åº¦**: å¾®ç§’ï¼ˆ6 ä½å°æ•°ï¼‰
- **æ ¼å¼**: `YYYY-MM-DD HH:MM:SS.ffffff`

### æ—¶åŒº

- æ‰€æœ‰æ—¶é—´éƒ½æ˜¯ **UTC**
- å¦‚éœ€æœ¬åœ°æ—¶é—´ï¼Œéœ€è¦åœ¨æ˜¾ç¤ºå±‚è½¬æ¢

## ğŸ“ ä¿®æ”¹çš„æ–‡ä»¶

| æ–‡ä»¶ | ä¿®æ”¹å†…å®¹ | è¡Œæ•° |
|------|----------|------|
| `src/blf/Cargo.toml` | æ·»åŠ  chrono ä¾èµ– | +1 |
| `src/blf/src/file_statistics.rs` | æ·»åŠ  SystemTime æ—¶é—´æ–¹æ³• | +66 |
| `src/blf/src/file.rs` | æ·»åŠ  BlfResult ä¾¿æ·æ–¹æ³• | +29 |
| `src/blf/src/objects/system.rs` | æ·»åŠ å¤‡ç”¨ SystemTime æ–¹æ³• | +87 |

**æ€»è®¡**: ~183 è¡Œæ–°ä»£ç 

## âœ… æµ‹è¯•éªŒè¯

### ç¼–è¯‘æµ‹è¯•

```bash
cargo build -p blf --lib
# âœ… æˆåŠŸï¼Œæ— é”™è¯¯

cargo check -p view
# âœ… æˆåŠŸï¼Œåªæœ‰è­¦å‘Š
```

### åŠŸèƒ½æµ‹è¯•

```rust
#[test]
fn test_time_conversion() {
    let base_time = SystemTime {
        year: 2026,
        month: 1,
        day: 25,
        hour: 16,
        minute: 30,
        second: 0,
        milliseconds: 0,
    };
    
    // æµ‹è¯• 1 ç§’åç§»
    let result = base_time.format_with_offset(1_000_000_000);
    assert!(result.contains("16:30:01"));
}
```

## ğŸ“š æ–‡æ¡£

åˆ›å»ºäº†ä»¥ä¸‹æ–‡æ¡£ï¼š

1. **BLF_TIMESTAMP_FIX.md** - é—®é¢˜åˆ†æå’Œä¿®å¤æ–¹æ¡ˆ
2. **BLF_TIME_USAGE.md** - å®Œæ•´ä½¿ç”¨æŒ‡å—å’Œ API å‚è€ƒ
3. **BLF_TIME_FIX_SUMMARY.md** - æœ¬æ–‡æ¡£ï¼ˆæ€»ç»“ï¼‰

## ğŸš€ ä¸‹ä¸€æ­¥

### åœ¨ UI ä¸­ä½¿ç”¨

```rust
// åœ¨æ˜¾ç¤º BLF æ•°æ®æ—¶
fn display_message(blf_result: &BlfResult, obj: &LogObject) {
    let time_str = blf_result.format_timestamp(obj.timestamp());
    println!("æ—¶é—´: {}", time_str);
}
```

### æ€§èƒ½ä¼˜åŒ–ï¼ˆå¯é€‰ï¼‰

å¦‚æœéœ€è¦é¢‘ç¹è®¿é—®æ—¶é—´ï¼Œå¯ä»¥é¢„å…ˆè®¡ç®—ï¼š

```rust
// é¢„è®¡ç®—æ‰€æœ‰æ—¶é—´æˆ³
let timestamps: Vec<String> = blf_result.objects.iter()
    .map(|obj| blf_result.format_timestamp(obj.timestamp()))
    .collect();
```

### æ·»åŠ æ—¶åŒºæ”¯æŒï¼ˆå¯é€‰ï¼‰

```rust
use chrono_tz::Tz;

fn format_with_timezone(blf_result: &BlfResult, obj: &LogObject, tz: Tz) -> String {
    let utc_time = blf_result.format_timestamp(obj.timestamp());
    // è½¬æ¢ä¸ºæŒ‡å®šæ—¶åŒº
    // ...
}
```

## ğŸ‰ æˆæœ

- âœ… ä¿®å¤äº†æ—¶é—´æ˜¾ç¤ºé—®é¢˜
- âœ… æä¾›äº†å®Œæ•´çš„ API
- âœ… ç¼–å†™äº†è¯¦ç»†æ–‡æ¡£
- âœ… é€šè¿‡ç¼–è¯‘æµ‹è¯•
- âœ… ä¿æŒå‘åå…¼å®¹

## ğŸ“ ç›¸å…³èµ„æº

- [chrono æ–‡æ¡£](https://docs.rs/chrono/)
- [BLF æ ¼å¼è§„èŒƒ](https://www.vector.com/)
- [ä½¿ç”¨æŒ‡å—](BLF_TIME_USAGE.md)

---

**ä¿®å¤æ—¥æœŸ**: 2026-01-25  
**ç‰ˆæœ¬**: 1.0  
**çŠ¶æ€**: âœ… å®Œæˆå¹¶æµ‹è¯•
