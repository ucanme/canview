# ä¿¡å·åº“è‡ªåŠ¨åŠ è½½ - ä¿®å¤è¯´æ˜

## ğŸ› é—®é¢˜æè¿°

**ç—‡çŠ¶**: æ·»åŠ åº“ã€ç‰ˆæœ¬ã€é€šé“åï¼Œå…³é—­è½¯ä»¶é‡æ–°æ‰“å¼€ï¼ŒLibrary è§†å›¾ä¸­æ²¡æœ‰æ˜¾ç¤ºä¹‹å‰æ·»åŠ çš„å†…å®¹ã€‚

## ğŸ” æ ¹æœ¬åŸå› 

åœ¨æ·»åŠ é€šé“æ—¶ï¼Œè™½ç„¶è°ƒç”¨äº† `save_config()`ï¼Œä½†æ˜¯**æ²¡æœ‰å°† `library_manager` ä¸­çš„æ•°æ®åŒæ­¥åˆ° `app_config.libraries`**ã€‚

### ä»£ç æµç¨‹

```
æ·»åŠ é€šé“ 
  â†“
ä¿®æ”¹ library_manager (å†…å­˜ä¸­)
  â†“
âŒ ç¼ºå°‘: åŒæ­¥åˆ° app_config.libraries
  â†“
save_config() ä¿å­˜ app_config
  â†“
ç»“æœ: ä¿å­˜çš„é…ç½®ä¸­æ²¡æœ‰æ–°æ·»åŠ çš„é€šé“
```

## âœ… ä¿®å¤æ–¹æ¡ˆ

åœ¨æ·»åŠ é€šé“æˆåŠŸåï¼Œæ·»åŠ åŒæ­¥é€»è¾‘ï¼š

```rust
// æ·»åŠ é€šé“æˆåŠŸå
match version.add_channel_database(channel_db) {
    Ok(_) => {
        // ... æ¸…ç†è¾“å…¥æ¡†ç­‰æ“ä½œ ...
        
        // ğŸ”„ åŒæ­¥åˆ° app_config (æ–°å¢)
        self.app_config.libraries = self.library_manager.libraries().to_vec();
        
        // ğŸ’¾ è‡ªåŠ¨ä¿å­˜é…ç½®
        self.save_config(cx);
        
        cx.notify();
    }
}
```

## ğŸ“ ä¿®æ”¹çš„æ–‡ä»¶

**æ–‡ä»¶**: `src/view/src/app/impls.rs`

**ä½ç½®**: `save_channel_config` å‡½æ•°ï¼Œç¬¬ 3936 è¡Œ

**ä¿®æ”¹**:
```diff
  // Reset type to CAN
  self.new_channel_type = crate::models::ChannelType::CAN;

+ // ğŸ”„ åŒæ­¥åˆ° app_config
+ self.app_config.libraries = self.library_manager.libraries().to_vec();
+
  // ğŸ’¾ è‡ªåŠ¨ä¿å­˜é…ç½®
  self.save_config(cx);
```

## ğŸ§ª éªŒè¯æ­¥éª¤

### æ­¥éª¤ 1: é‡æ–°ç¼–è¯‘

```bash
cargo build --release -p view
```

### æ­¥éª¤ 2: æµ‹è¯•æ·»åŠ å’ŒåŠ è½½

```bash
# 1. è¿è¡Œç¨‹åº
cargo run -p view --release

# 2. åˆ‡æ¢åˆ° Library è§†å›¾

# 3. åˆ›å»ºåº“
#    - ç‚¹å‡» "+ Add Library"
#    - è¾“å…¥: "TestLib"
#    - æŒ‰ Enter

# 4. æ·»åŠ ç‰ˆæœ¬
#    - é€‰æ‹© TestLib
#    - ç‚¹å‡» "+ Add Version"
#    - è¾“å…¥: "v1.0"
#    - æŒ‰ Enter

# 5. æ·»åŠ é€šé“
#    - ç‚¹å‡» "+ Add Channel"
#    - é€šé“ ID: "1"
#    - é€šé“åç§°: "CAN1"
#    - é€‰æ‹©æ–‡ä»¶: sample.dbc
#    - ç‚¹å‡» "Save"

# 6. éªŒè¯é…ç½®æ–‡ä»¶
cat multi_channel_config.json
# åº”è¯¥çœ‹åˆ°å®Œæ•´çš„åº“ã€ç‰ˆæœ¬ã€é€šé“ä¿¡æ¯

# 7. å…³é—­ç¨‹åº

# 8. é‡æ–°å¯åŠ¨
cargo run -p view --release

# 9. æŸ¥çœ‹æ§åˆ¶å°è¾“å‡º
# åº”è¯¥çœ‹åˆ°:
ğŸ“š åŠ è½½ä¿¡å·åº“é…ç½®...
  æ‰¾åˆ° 1 ä¸ªä¿¡å·åº“
  âœ… åŠ è½½å®Œæˆ:
     - 1 ä¸ªåº“
     - 1 ä¸ªç‰ˆæœ¬
     - 1 ä¸ªé€šé“
     ğŸ“¦ TestLib: 1 ä¸ªç‰ˆæœ¬

# 10. åˆ‡æ¢åˆ° Library è§†å›¾
# åº”è¯¥çœ‹åˆ° TestLib åŠå…¶ç‰ˆæœ¬å’Œé€šé“
```

## ğŸ“Š é¢„æœŸç»“æœ

### é…ç½®æ–‡ä»¶å†…å®¹

```json
{
  "libraries": [
    {
      "id": "lib_xxx",
      "name": "TestLib",
      "channel_type": "CAN",
      "versions": [
        {
          "name": "v1.0",
          "path": "",
          "date": "2026-01-25",
          "description": "Created version 'v1.0' (database file to be added)",
          "channel_databases": [
            {
              "channel_type": "CAN",
              "channel_id": 1,
              "channel_name": "CAN1",
              "database_path": "config/signal_library/TestLib/v1.0/sample.dbc"
            }
          ]
        }
      ]
    }
  ],
  "mappings": [],
  "active_library_id": null,
  "active_version_name": null
}
```

### æ§åˆ¶å°è¾“å‡º

å¯åŠ¨æ—¶åº”è¯¥çœ‹åˆ°ï¼š

```
ğŸ“š åŠ è½½ä¿¡å·åº“é…ç½®...
  æ‰¾åˆ° 1 ä¸ªä¿¡å·åº“
  âœ… åŠ è½½å®Œæˆ:
     - 1 ä¸ªåº“
     - 1 ä¸ªç‰ˆæœ¬
     - 1 ä¸ªé€šé“
     ğŸ“¦ TestLib: 1 ä¸ªç‰ˆæœ¬
```

### UI æ˜¾ç¤º

Library è§†å›¾åº”è¯¥æ˜¾ç¤ºï¼š
```
ğŸ“¦ TestLib
  â””â”€ ğŸ“ v1.0
      â””â”€ ğŸ”Œ CAN1 (ID: 1)
```

## ğŸ”„ å®Œæ•´çš„åŒæ­¥ç‚¹

ç°åœ¨æ‰€æœ‰æ“ä½œéƒ½ä¼šæ­£ç¡®åŒæ­¥ï¼š

| æ“ä½œ | åŒæ­¥ä½ç½® | çŠ¶æ€ |
|------|----------|------|
| åˆ›å»ºåº“ | `impls.rs:3581` | âœ… å·²æœ‰ |
| æ·»åŠ ç‰ˆæœ¬ | `impls.rs:3661` | âœ… å·²æœ‰ |
| æ·»åŠ é€šé“ | `impls.rs:3936` | âœ… æ–°å¢ |
| åˆ é™¤åº“ | - | âš ï¸ å¾…æ·»åŠ  |
| åˆ é™¤ç‰ˆæœ¬ | - | âš ï¸ å¾…æ·»åŠ  |
| åˆ é™¤é€šé“ | - | âš ï¸ å¾…æ·»åŠ  |

## ğŸ’¡ è®¾è®¡åŸåˆ™

### æ•°æ®æµ

```
ç”¨æˆ·æ“ä½œ
  â†“
ä¿®æ”¹ library_manager (å†…å­˜)
  â†“
åŒæ­¥åˆ° app_config.libraries
  â†“
save_config() ä¿å­˜åˆ°æ–‡ä»¶
  â†“
é‡å¯å load_startup_config() åŠ è½½
  â†“
æ¢å¤åˆ° library_manager
```

### å…³é”®ç‚¹

1. **library_manager** - å†…å­˜ä¸­çš„å·¥ä½œå‰¯æœ¬
2. **app_config.libraries** - åºåˆ—åŒ–çš„æ•°æ®æº
3. **åŒæ­¥æ—¶æœº** - æ¯æ¬¡ä¿®æ”¹åç«‹å³åŒæ­¥
4. **ä¿å­˜æ—¶æœº** - åŒæ­¥åç«‹å³ä¿å­˜

## âœ… éªŒè¯æ¸…å•

ä¿®å¤åéªŒè¯ï¼š

- [ ] åˆ›å»ºåº“ â†’ ä¿å­˜ â†’ é‡å¯ â†’ åº“å­˜åœ¨
- [ ] æ·»åŠ ç‰ˆæœ¬ â†’ ä¿å­˜ â†’ é‡å¯ â†’ ç‰ˆæœ¬å­˜åœ¨
- [ ] æ·»åŠ é€šé“ â†’ ä¿å­˜ â†’ é‡å¯ â†’ é€šé“å­˜åœ¨
- [ ] é…ç½®æ–‡ä»¶åŒ…å«å®Œæ•´ä¿¡æ¯
- [ ] æ§åˆ¶å°æ˜¾ç¤ºåŠ è½½ä¿¡æ¯
- [ ] UI æ­£ç¡®æ˜¾ç¤ºæ‰€æœ‰å†…å®¹

## ğŸ¯ åç»­ä¼˜åŒ–

### å»ºè®®æ·»åŠ 

1. **åˆ é™¤æ“ä½œçš„åŒæ­¥**
   - åˆ é™¤åº“æ—¶åŒæ­¥
   - åˆ é™¤ç‰ˆæœ¬æ—¶åŒæ­¥
   - åˆ é™¤é€šé“æ—¶åŒæ­¥

2. **é”™è¯¯å¤„ç†**
   - ä¿å­˜å¤±è´¥æ—¶çš„æç¤º
   - åŠ è½½å¤±è´¥æ—¶çš„æ¢å¤

3. **å¤‡ä»½æœºåˆ¶**
   - ä¿å­˜å‰å¤‡ä»½æ—§é…ç½®
   - åŠ è½½å¤±è´¥æ—¶æ¢å¤å¤‡ä»½

---

**ä¿®å¤æ—¥æœŸ**: 2026-01-25  
**çŠ¶æ€**: âœ… å·²ä¿®å¤  
**æµ‹è¯•**: âœ… å¾…éªŒè¯
