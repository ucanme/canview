# 输入法（IME）支持问题 - 快速参考

## 📋 问题概述

**用户反馈**：在信号库管理中，中文输入法使用不便

**当前状态**：
- ✅ 可以存储和显示中文
- ❌ 输入时无法使用输入法选择候选词

---

## 🔧 临时解决方案

### 方法 1：使用剪贴板（最简单）

1. 在记事本中输入中文名
   ```
   测试CAN信号库
   ```

2. 复制文本（Ctrl+C）

3. 在应用中粘贴（Ctrl+V）

4. 点击 "Create" 创建库

### 方法 2：编辑配置文件

1. 打开配置文件 `multi_channel_config.json`

2. 直接编辑中文名称：
   ```json
   {
     "libraries": [
       {
         "id": "library_1",
         "name": "测试CAN信号库",
         "channel_type": "CAN",
         "versions": []
       }
     ]
   }
   ```

3. 保存文件

4. 在应用中加载配置文件

### 方法 3：先用英文后改名

1. 创建库时使用英文名
   ```
   TestLibrary
   ```

2. 编辑配置文件，将 `name` 改为中文
   ```json
   "name": "测试CAN信号库"
   ```

3. 重新加载应用

---

## 🎯 什么样的输入法有问题？

### ❌ 有问题的场景

```
场景：直接使用输入法输入中文

操作：
1. 点击 "+ New"
2. 打开中文输入法
3. 输入拼音 "cesexinhao ku"
4. 从候选词中选择 "测试信号库"

结果：
❌ 只显示 "cesexinhao ku"
❌ 没有显示 "测试信号库"
```

### ✅ 正常的场景

```
场景：使用剪贴板粘贴中文

操作：
1. 记事本中输入 "测试信号库"
2. 复制（Ctrl+C）
3. 在应用中粘贴（Ctrl+V）

结果：
✅ 正确显示 "测试信号库"
```

---

## 💡 支持的字符格式

### 库名（支持中文）

✅ **支持的例子**：
- `测试CAN信号库`
- `Test测试库123`
- `CAN测试库`
- `📊 数据分析库`

**规则**：
- 支持中文、日文、韩文
- 支持英文和数字
- 支持空格
- 支持表情符号

### 版本名（仅支持英文）

✅ **支持的例子**：
- `v1.0.0`
- `version_1.2`
- `release-2.0`
- `v1.2.3-beta`

**规则**：
- 仅支持英文字母、数字
- 支持点号（.）、下划线（_）、连字符（-）
- **不支持**空格（这是设计特性）

---

## 🚀 开发修复计划

我们正在努力解决输入法问题，预计修复时间：1-2 周

### 修复内容

1. **研究正确的 API**
   - 查找 GPUI 框架的文本输入接口
   - 参考 Zed 编辑器的实现

2. **改进输入处理**
   - 支持输入法候选词选择
   - 支持预编辑状态显示
   - 支持多字符文本输入

3. **全面测试**
   - 中文拼音输入法
   - 中文五笔输入法
   - 日文输入法
   - 韩文输入法
   - 混合输入

---

## 📝 测试步骤（开发人员）

### 1. 运行应用
```bash
cargo run --release
```

### 2. 导航到库管理
- 点击 "Config" 视图

### 3. 测试输入法
```
输入：cesexinhao ku
选择：测试信号库

预期：
✅ 修复后：显示 "测试信号库"
❌ 修复前：显示 "cesexinhao ku"
```

### 4. 测试混合输入
```
输入：CAN测试库2024

检查：
✅ 光标位置正确（10个字符）
✅ 退格键删除中文字符
✅ 箭头键按字符移动
```

---

## 📚 技术细节

### 为什么会有这个问题？

**原因**：当前使用键盘事件处理输入

```
用户输入 "nihao" → 选择 "你好"
        ↓                    ↓
   按键事件            文本输入事件
   (当前使用)         (需要改用)
```

**问题**：
- 按键事件只能获取到 `'n'`, `'i'`, `'h'`, `'a'`, `'o'`
- 无法获取到输入法输出的 `'你好'`

**解决方案**：
- 使用文本输入事件（`on_input`）
- 而不是按键事件（`on_key_down`）

### 数据支持情况

✅ **完全支持**：
- 存储 UTF-8 字符
- 显示中文、日文、韩文
- 字符级光标位置
- 正确删除多字节字符

❌ **不支持**：
- 输入法候选词选择
- 输入法预编辑状态
- 直接输入法输入

---

## 📞 反馈

如果您遇到输入法问题，请提供以下信息：

1. **操作系统**：Windows 10 / Windows 11 / macOS / Linux
2. **输入法**：微软拼音 / 搜狗拼音 / 五笔 / 其他
3. **具体操作**：
   - 您输入的是什么？
   - 期望显示什么？
   - 实际显示了什么？
4. **错误截图**：如果有

---

## 🔗 相关文档

- `IME_INPUT_SUPPORT.md` - 详细技术分析
- `INPUT_CHARACTER_SUPPORT.md` - 字符支持说明
- `TEXTINPUT_TEST.md` - 组件测试说明

---

**最后更新**：2024
**状态**：🚧 正在修复中
**优先级**：🔴 高